<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip="">

  <py:def function="page_title">${c.pkg.title or c.pkg.name} - Data Packages</py:def>
      
  <py:match path="primarysidebar">
  
    <li class="widget-container widget_text" py:if="not c.hide_welcome_message">
      <h3>First time at ${g.site_title}?</h3>        
      <p>
          ${g.site_title} is a catalogue for data. ${h.subnav_link(c, _('Click here to find out more ...'), controller='home', action='about', id=None)}
      </p>
    </li>

    <li class="widget-container widget_text">
        <h4>Tags</h4>
        ${tag_list(c.pkg.tags)}
        <p class="widget_action">
            ${h.subnav_link(c, 'Add a new Tag', controller='package', action='edit', id=c.pkg.name)}
        </p>
    </li>

    <li class="widget-container widget_text">
        <h4>Groups</h4>
        <py:if test="c.pkg.groups">        
            <ul>
              <li py:for="group in c.pkg.groups">
                  <a href="${h.url_for(controller='group', action='read', id=group.name)}">${group.name}</a>
              </li>
            </ul>
        </py:if>
        <py:if test="not c.pkg.groups">
             Groups are collecitons of packages maintained by users of ${g.site_title}. This package has not been added to any groups yet.
        </py:if>
        <p class="widget_action">
            ${h.subnav_link(c, 'Add to a Group', controller='package', action='edit', id=c.pkg.name)}        
        </p>
    </li>
    
    <py:if test="c.package_relationships">
        <li class="widget-container widget_text">
              <h3>Related packages</h3>
              <ul>
                <py:for each="pkg, relationship_str, comment in c.package_relationships">
                  <li>
                    ${h.literal(relationship_str % (h.link_to(pkg.name, h.url_for(controller="package", action="read", id=pkg.name))))}
                    <span py:if="comment is not None and len(comment)" class="relationship_comment">
                        (${comment})
                    </span>
                  </li>
                </py:for>
              </ul>
        </li>
    </py:if>
    
    <li class="widget-container widget_text">
      <h2>Openness:
        <py:choose test="">
        <span py:when="c.pkg.isopen() and c.pkg.resources" class="okd">
          OPEN
        </span>
        <span py:otherwise="">
          NOT OPEN
        </span>
        </py:choose>
      </h2>
      <py:choose test="">
        <p py:when="c.pkg.license_id">
          This package is licensed with
          <py:choose test="">
            <strong py:when="c.pkg.license and c.pkg.license.url"><br /><a href="${c.pkg.license.url}">${c.pkg.license.title}</a></strong>
            <strong py:when="c.pkg.license"><br />${c.pkg.license.title}</strong>
            <strong py:when="c.pkg.license_id"><br />${c.pkg.license_id}</strong>
          </py:choose>
        </p>
        <p py:otherwise="">
          License not given
        </p>
      </py:choose>

      <py:choose>
        <p py:when="c.pkg.isopen() and c.pkg.resources" class="okd">
          <a
            href="http://www.opendefinition.org/okd/"
            title="This package satisfies the Open Knowledge Definition.">
            <img src="http://assets.okfn.org/images/ok_buttons/od_80x15_blue.png" alt="[Open Data]" /></a>
          <a
            href="http://www.opendefinition.org/okd/"
            title="This package satisfies the Open Knowledge Definition.">
            <img src="http://assets.okfn.org/images/ok_buttons/oc_80x15_blue.png" alt="[Open Content]" /></a>
        </p>
      <div py:otherwise="">
      <h5>Help Make This Package Open!</h5>
      <p i18n:msg="">This package is <strong>not open</strong> as it is
      <strong>not openly licensed</strong> or is
      <strong>missing downloadable resources</strong>. Help
      make it open by 
        <a href="http://www.isitopendata.org/enquiry/start/?ckan_package=${c.pkg.name}">starting an enquiry</a>
        using the
        <a href="http://www.isitopendata.org/">Is It Open
          Data service</a>.</p>
      </div>
      </py:choose>
    </li>
  </py:match>

  <div py:match="content">
    <xi:include href="read_core.html" />
  </div>

  <py:if test="config.get('rdf_packages')">
    <py:def function="optional_head">
      <link rel="alternate" type="application/rdf+xml" title="RDF Version" href="${config['rdf_packages'] + c.pkg.name[0] + '/' + c.pkg.name[1] + '/' + c.pkg.name}" />
    </py:def>
  </py:if>

  <py:def function="optional_feed">
  <link rel="alternate" type="application/atom+xml" title="Package History"
    href="${url(controller='package', action='history', id=c.pkg.name, format='atom', days=7)}" />
  </py:def>

  <xi:include href="layout.html" />
</html>

